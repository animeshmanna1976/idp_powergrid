<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POWERGRID Intelligent IDP System</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script type="module" src="https://unpkg.com/lucide@latest"></script>
    <!-- Custom Style Block for Design Reference -->
    <style>
        /* Import the consistent Inter font family */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --powergrid-blue: #1E3A8A; /* Deep Blue for Primary */
            --powergrid-accent: #3B82F6; /* Lighter Blue for Accent */
        }

        body {
            font-family: 'Inter', sans-serif;
            color: #2d3748;
            /* Using the gradient background from the reference code */
            background: linear-gradient(135deg, #e0f2fe 0%, #ffffff 75%);
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        .container {
            max-width: 1200px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            /* Subtle hover effect for general cards */
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -4px rgba(0, 0, 0, 0.15);
        }
        
        /* 9-Box Matrix Styling */
        .nine-box-cell {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid rgba(209, 213, 219, 0.5); /* Light border inside grid */
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Improved contrast for text within colored boxes */
            color: #1F2937; /* Dark text for readability */
        }
        .nine-box-cell:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        /* Styling the clickable employee initials */
        .employee-initial-btn {
            background-color: white; 
            color: var(--powergrid-blue); 
            border: 2px solid var(--powergrid-blue); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 0.8rem;
        }
        .employee-initial-btn:hover {
            background-color: var(--powergrid-blue); 
            color: white; 
            transform: scale(1.15);
        }

        /* Y-axis labels for 9-Box Matrix */
        .nine-box-y-label {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            padding: 8px 4px;
            font-size: 0.75rem;
            font-weight: bold;
            color: #4B5563; 
            border-right: 1px solid #D1D5DB;
            background-color: #F3F4F6;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading-animation {
            border: 4px solid #F3F4F6;
            border-top: 4px solid var(--powergrid-accent);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* SVG Doughnut Chart Animation (Infographics) */
        .doughnut-segment {
             transition: stroke-dashoffset 1s ease-in-out;
        }
    </style>
    <!-- Load Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Expose Firebase objects globally for use in the main script
        window.firebase = {
            initializeApp,
            getAuth,
            signInAnonymously,
            signInWithCustomToken,
            onAuthStateChanged,
            getFirestore,
            doc,
            getDoc,
            addDoc,
            setDoc,
            updateDoc,
            deleteDoc,
            onSnapshot,
            collection,
            query,
            where,
            getDocs,
            serverTimestamp,
            setLogLevel
        };
    </script>
</head>
<body class="p-4 md:p-8">

    <!-- Global State Variables & Firebase Setup -->
    <script>
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-sih-idp-app';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth, currentUserId = null;
        let authReady = false;

        const STATE = {
            currentView: 'home', // Changed default to 'home'
            selectedEmployee: null,
            selectedRole: null,
            recommendationResult: null, 
            idpList: [],
            isLoading: false,
            alertMessage: null,
            isAlertVisible: false,
            isAdmin: true, // Assuming Committee members have admin access for demo
        };

        const EMPLOYEE_DATA = [
            // Note: Performance (Y), Potential (X) - 1 to 5 scale
            { id: 1, name: 'Suman Sharma', position: 'Sr. Manager (HR)', performance: 4, potential: 5, adcScore: 85, history: 'Completed 2 Job Rotations, Mentored 3 juniors.' }, // High Potential
            { id: 2, name: 'Rahul Verma', position: 'Manager (Transmission)', performance: 3, potential: 4, adcScore: 78, history: 'Led NER Project (2023), Completed Technical Certifications.' }, // High Potential (Lower Perf)
            { id: 3, name: 'Priya Jain', position: 'Dy. Manager (Finance)', performance: 5, potential: 5, adcScore: 92, history: 'Top Performer, High Potential designation 3 years running.' }, // Top Talent (Admin user)
            { id: 4, name: 'Amit Kumar', position: 'Asst. Manager (Civil)', performance: 2, potential: 2, adcScore: 65, history: 'Requires focus on core role competencies.' }, // Underperformer
        ];

        const ROLE_DATA = [
            { id: 'R1', title: 'General Manager (Regional Head)', competencies: { strategicThinking: 90, financialAcumen: 80, teamLeadership: 95, geographicalExpertise: 90 } },
            { id: 'R2', title: 'Head of National Load Dispatch Center', competencies: { strategicThinking: 95, technicalExpertise: 90, crisisManagement: 85, stakeholderManagement: 80 } },
            { id: 'R3', title: 'Chief Financial Officer', competencies: { financialAcumen: 95, complianceKnowledge: 90, riskManagement: 85, communication: 75 } },
        ];

        const AVAILABLE_ACTIVITIES = [
            { id: 'A1', type: 'Job Rotation', title: '3-Month Assignment to NER (North-Eastern Region)', competencyImpact: { geographicalExpertise: 20, teamLeadership: 5 } },
            { id: 'A2', type: 'Training Module', title: 'Advanced Strategic Leadership Workshop (Internal)', competencyImpact: { strategicThinking: 15, teamLeadership: 10 } },
            { id: 'A3', type: 'Enrichment Project', title: 'Lead Digital Transformation Pilot Project', competencyImpact: { strategicThinking: 5, technicalExpertise: 15 } },
            { id: 'A4', type: 'Mentorship', title: 'Paired with Director (Operations) for 6 months', competencyImpact: { teamLeadership: 10, communication: 5 } },
            { id: 'A5', type: 'Training Module', title: 'Financial Modeling and Risk Analysis Course', competencyImpact: { financialAcumen: 15, riskManagement: 10 } },
        ];
        
        // --- Utility Functions ---
        const navigate = (view) => {
            STATE.currentView = view;
            renderApp();
        };

        const setAlert = (message) => {
            STATE.alertMessage = message;
            STATE.isAlertVisible = true;
            renderApp();
            setTimeout(() => {
                STATE.isAlertVisible = false;
                renderApp();
            }, 5000);
        };

        const showLoading = (state) => {
            STATE.isLoading = state;
            renderApp();
        };
        
        // Function to handle 9-Box Click
        const viewEmployeeRecords = (employeeId) => {
            const employee = EMPLOYEE_DATA.find(e => e.id == employeeId);
            if (employee) {
                STATE.selectedEmployee = employee;
                navigate('employeeDetail');
            } else {
                setAlert("Error: Employee data not found.");
            }
        };
        
        const viewIDPDetail = (idpId) => {
            const idp = STATE.idpList.find(i => i.id === idpId);
            if (idp) {
                STATE.recommendationResult = idp;
                navigate('recommendation');
            } else {
                setAlert("Error: Could not find IDP record.");
            }
        };

        // Utility to map Performance (Y) and Potential (X) to 9-Box Quadrant
        const getNineBoxPosition = (performance, potential) => {
            let p = ''; 
            if (performance >= 4) p = 'High';
            else if (performance === 3) p = 'Moderate';
            else p = 'Low';

            let t = ''; 
            if (potential >= 4) t = 'High';
            else if (potential === 3) t = 'Moderate';
            else t = 'Low';

            // Quadrant mapping (Y, X) - Simplified based on common HR practice
            // Using standard colors for HR clarity, combined with Tailwind classes
            if (p === 'High' && t === 'High') return { label: 'Top Talent', color: 'bg-green-500', code: '9A' };
            if (p === 'High' && t === 'Moderate') return { label: 'Impact Player', color: 'bg-green-300', code: '8B' };
            if (p === 'High' && t === 'Low') return { label: 'Solid Performer', color: 'bg-yellow-300', code: '7C' };

            if (p === 'Moderate' && t === 'High') return { label: 'High Potential', color: 'bg-yellow-500', code: '6B' };
            if (p === 'Moderate' && t === 'Moderate') return { label: 'Core Player', color: 'bg-gray-300', code: '5B' };
            if (p === 'Moderate' && t === 'Low') return { label: 'Effective Contributor', color: 'bg-orange-400', code: '4C' };

            if (p === 'Low' && t === 'High') return { label: 'Potential Gem', color: 'bg-red-400', code: '3A' };
            if (p === 'Low' && t === 'Moderate') return { label: 'Question Mark', color: 'bg-red-500', code: '2B' };
            if (p === 'Low' && t === 'Low') return { label: 'Underperformer', color: 'bg-red-700', code: '1C' };

            return { label: 'N/A', color: 'bg-gray-200', code: 'N/A' };
        };

        // --- Firebase/Firestore Functions (unchanged for brevity) ---
        const initializeFirebase = async () => {
            if (!firebaseConfig) {
                console.error("Firebase configuration is missing. Running in demo mode.");
                setAlert("System Demo Mode: Firebase config not found. Data is not persistent.");
                authReady = true;
                STATE.isAdmin = true;
                loadIDPsDemo();
                renderApp();
                return;
            }

            try {
                // setLogLevel('Debug');
                app = firebase.initializeApp(firebaseConfig);
                db = firebase.getFirestore(app);
                auth = firebase.getAuth(app);

                if (initialAuthToken) {
                    await firebase.signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await firebase.signInAnonymously(auth);
                }

                firebase.onAuthStateChanged(auth, (user) => {
                    currentUserId = user ? user.uid : 'anonymous';
                    const adminEmployee = EMPLOYEE_DATA.find(e => e.id === 3);
                    if (currentUserId === 'anonymous' && adminEmployee) {
                         currentUserId = adminEmployee.id; 
                    }
                    STATE.isAdmin = (currentUserId === adminEmployee.id); 
                    authReady = true;
                    loadIDPs();
                    renderApp();
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                setAlert("Authentication failed. Please check console for details.");
            }
        };

        const getIDPCollectionRef = () => {
            const collectionPath = `artifacts/${appId}/public/data/idps`;
            return firebase.collection(db, collectionPath);
        };

        const loadIDPsDemo = () => {
            // Simulated demo data if Firebase is unavailable
            const demoIDPs = [
                { id: 'D1', employee: EMPLOYEE_DATA[2], role: ROLE_DATA[2], status: 'Completed', completion: 100, activities: [{title: 'Finance Mastery', predictedImpact: 10, type: 'Training', assignedTo: 'Financial Acumen', status: 'Completed'}] },
                { id: 'D2', employee: EMPLOYEE_DATA[0], role: ROLE_DATA[0], status: 'In Progress', completion: 50, activities: [{title: 'Job Rotation', predictedImpact: 20, type: 'Job Rotation', assignedTo: 'Geographical Expertise', status: 'In Progress'}] },
            ];
            STATE.idpList = demoIDPs;
        }

        const loadIDPs = () => {
            if (!authReady || !db) return;
            const idpQuery = firebase.query(getIDPCollectionRef());

            firebase.onSnapshot(idpQuery, (snapshot) => {
                const idpList = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                STATE.idpList = idpList.sort((a, b) => (b.createdAt?.toMillis() || 0) - (a.createdAt?.toMillis() || 0));
                renderApp();
            }, (error) => {
                console.error("Error loading IDPs:", error);
                setAlert("Failed to load IDP dashboard data.");
            });
        };

        const saveIDP = async (idpData) => {
            showLoading(true);
            try {
                if (!db) {
                     loadIDPsDemo();
                     setAlert(`IDP for ${idpData.employee.name} saved to DEMO list successfully.`);
                } else {
                    const docRef = await firebase.addDoc(getIDPCollectionRef(), {
                        ...idpData,
                        committeeId: currentUserId,
                        createdAt: firebase.serverTimestamp(),
                    });
                    setAlert(`IDP for ${idpData.employee.name} saved successfully with ID: ${docRef.id}`);
                }
                
                STATE.recommendationResult = null; 
                navigate('matrix');
            } catch (e) {
                console.error("Error saving document: ", e);
                setAlert("Error saving IDP. Check console for details.");
            } finally {
                showLoading(false);
            }
        };

        const simulateAIRecommendation = (employee, role) => {
            const employeeProfile = {
                strategicThinking: 60 + Math.floor(employee.adcScore / 10),
                financialAcumen: employee.position.includes('Finance') ? 85 : 50,
                teamLeadership: employee.position.includes('Manager') ? 70 : 60,
                geographicalExpertise: 50,
                technicalExpertise: employee.position.includes('Transmission') ? 75 : 55,
                crisisManagement: 60,
                complianceKnowledge: 55,
                riskManagement: 50,
                communication: 70
            };

            const required = role.competencies;
            const gaps = {};
            const gapDetails = [];

            Object.keys(required).forEach(key => {
                const target = required[key];
                const current = employeeProfile[key] || 50;
                const gap = Math.max(0, target - current);
                gaps[key] = gap;

                if (gap > 0) {
                    gapDetails.push({
                        name: key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()),
                        required: target,
                        current: current,
                        gap: gap,
                    });
                }
            });

            gapDetails.sort((a, b) => b.gap - a.gap);
            const prioritizedActivities = [];
            const remainingGaps = {...gaps};
            let activityCounter = 0;

            while (activityCounter < 4 && gapDetails.some(g => remainingGaps[Object.keys(required).find(key => key.includes(g.name.replace(/\s/g, '').toLowerCase().substring(0, 4)))] > 10)) {
                
                const highGap = gapDetails.find(g => remainingGaps[Object.keys(required).find(key => key.includes(g.name.replace(/\s/g, '').toLowerCase().substring(0, 4)))] > 10);
                if (!highGap) break;

                const targetCompKey = Object.keys(required).find(key => key.includes(highGap.name.replace(/\s/g, '').toLowerCase().substring(0, 4)));

                const relevantActivity = AVAILABLE_ACTIVITIES.find(a => 
                    a.competencyImpact[targetCompKey] > 0 && 
                    !prioritizedActivities.some(pa => pa.id === a.id)
                );

                if (relevantActivity) {
                    const impactScore = relevantActivity.competencyImpact[targetCompKey] || 0;
                    
                    prioritizedActivities.push({
                        ...relevantActivity,
                        isMandatory: true,
                        assignedTo: targetCompKey.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()),
                        predictedImpact: impactScore,
                        status: 'Planned',
                        progress: 0,
                    });
                    remainingGaps[targetCompKey] = Math.max(0, remainingGaps[targetCompKey] - impactScore);
                    activityCounter++;
                } else {
                    const fallback = AVAILABLE_ACTIVITIES.find(a => !prioritizedActivities.some(pa => pa.id === a.id));
                    if (fallback) {
                         prioritizedActivities.push({...fallback, isMandatory: false, assignedTo: 'General Development', predictedImpact: 5, status: 'Planned', progress: 0,});
                         activityCounter++;
                    } else {
                        break;
                    }
                }
            }

            return {
                employee: employee,
                role: role,
                gapDetails: gapDetails,
                activities: prioritizedActivities,
                status: 'Draft',
                completion: 0
            };
        };

        const generateIDP = () => {
            const employeeId = document.getElementById('employee-select').value;
            const roleId = document.getElementById('role-select').value;

            if (!employeeId || !roleId) {
                setAlert("Please select both an employee and a target key role.");
                return;
            }

            const employee = EMPLOYEE_DATA.find(e => e.id == employeeId);
            const role = ROLE_DATA.find(r => r.id === roleId);
            
            showLoading(true);
            setTimeout(() => { // Simulate AI/API latency
                STATE.recommendationResult = simulateAIRecommendation(employee, role);
                navigate('recommendation');
                showLoading(false);
            }, 1000);
        };

        const updateActivityStatus = async (idpId, activityIndex, newStatus, totalActivities) => {
            showLoading(true);
            try {
                if (!db) {
                     setAlert("Cannot update in Demo Mode.");
                     showLoading(false);
                     return;
                }
                const idpDocRef = firebase.doc(db, getIDPCollectionRef().path, idpId);
                const currentIDP = STATE.idpList.find(i => i.id === idpId);

                if (!currentIDP) {
                    setAlert("Error: IDP not found for activity update.");
                    showLoading(false);
                    return;
                }

                const updatedActivities = JSON.parse(JSON.stringify(currentIDP.activities));
                
                if (updatedActivities[activityIndex].status !== 'Completed') {
                    updatedActivities[activityIndex].status = newStatus;
                } else {
                     setAlert("Activity is already marked completed.");
                     showLoading(false);
                     return;
                }
                
                const completedCount = updatedActivities.filter(a => a.status === 'Completed').length;
                const newCompletion = Math.floor((completedCount / totalActivities) * 100);

                const updateData = {
                    activities: updatedActivities,
                    completion: newCompletion,
                    status: newCompletion === 100 ? 'Completed' : 'In Progress',
                    updatedAt: firebase.serverTimestamp()
                };

                await firebase.updateDoc(idpDocRef, updateData);
                setAlert(`Activity updated. IDP completion is now ${newCompletion}%.`);
                
                STATE.recommendationResult = {...currentIDP, ...updateData, id: idpId};
                
            } catch (e) {
                console.error("Error updating IDP activity status: ", e);
                setAlert("Error updating activity status. Check console for details.");
            } finally {
                showLoading(false);
            }
        };

        // --- Utility: Renders a dynamic SVG Doughnut Chart for competencies (Infographics) ---
        const renderDoughnutChart = (data, title = 'Gap') => {
            const size = 150;
            const radius = 60;
            const circumference = 2 * Math.PI * radius;
            const center = size / 2;
            let currentOffset = 0;
            let total = data.reduce((sum, d) => sum + d.value, 0);

            if (total === 0 || data.length === 0) return `<div class="p-4 text-center text-gray-500">No gap data for visualization.</div>`;

            const segments = data.map(d => {
                const percentage = d.value / total;
                const strokeDasharray = `${percentage * circumference} ${circumference}`;
                const offset = circumference - currentOffset;
                currentOffset += percentage * circumference;

                return `
                    <circle 
                        r="${radius}" 
                        cx="${center}" 
                        cy="${center}" 
                        fill="transparent" 
                        stroke="${d.color}" 
                        stroke-width="15" 
                        stroke-dasharray="${strokeDasharray}" 
                        stroke-dashoffset="${offset}"
                        class="doughnut-segment"
                        title="${d.label}: ${d.value} Points"
                    />
                `;
            }).join('');

            return `
                <div class="relative w-[${size}px] h-[${size}px] mx-auto mb-4">
                    <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" class="transform -rotate-90">
                        <!-- Background Circle -->
                        <circle r="${radius}" cx="${center}" cy="${center}" fill="transparent" stroke="#E5E7EB" stroke-width="15" />
                        <!-- Data Segments -->
                        ${segments}
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center flex-col">
                        <span class="text-2xl font-bold text-gray-800">${total}</span>
                        <span class="text-xs font-medium text-gray-500">${title} Pts</span>
                    </div>
                </div>
            `;
        };

        const renderApp = () => {
            const appContainer = document.getElementById('app');
            let content = '';
            
            // --- Helper for icons ---
            const icon = (name, className = 'w-5 h-5') => `<i data-lucide="${name}" class="${className} inline-block"></i>`;

            // --- Component: Custom Alert Modal ---
            const renderAlert = () => `
                <div id="alert-modal" class="fixed top-4 right-4 z-50 transition-transform transform ${STATE.isAlertVisible ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0 pointer-events-none'}" style="min-width: 300px;">
                    <div class="bg-red-600 text-white p-4 rounded-lg shadow-xl flex items-center space-x-3">
                        ${icon('alert-triangle', 'w-6 h-6')}
                        <p class="font-medium">${STATE.alertMessage}</p>
                        <button onclick="STATE.isAlertVisible = false; renderApp();" class="ml-auto p-1 rounded-full hover:bg-red-700">
                            ${icon('x', 'w-4 h-4')}
                        </button>
                    </div>
                </div>
            `;


            // --- Component: Header (Styled for POWERGRID/Corporate Look) ---
            const renderHeader = () => `
                <header class="bg-white shadow-lg sticky top-0 z-10 p-4 md:p-6">
                    <div class="max-w-7xl mx-auto flex justify-between items-center">
                        <div class="flex items-center space-x-3">
                            ${icon('zap', 'w-7 h-7 text-indigo-600')}
                            <h1 class="text-2xl font-extrabold text-gray-900">
                                POWERGRID IDP Navigator
                            </h1>
                        </div>
                        
                        <nav class="flex flex-wrap gap-4 text-gray-600 font-medium text-sm sm:text-base">
                            <a onclick="navigate('home')" class="hover:text-indigo-600 transition-colors cursor-pointer flex items-center">
                                ${icon('home', 'w-4 h-4 mr-1')} Home
                            </a>
                            <a onclick="navigate('matrix')" class="hover:text-indigo-600 transition-colors cursor-pointer flex items-center">
                                ${icon('grid', 'w-4 h-4 mr-1')} 9-Box Matrix
                            </a>
                            <a onclick="navigate('about')" class="hover:text-indigo-600 transition-colors cursor-pointer flex items-center">
                                ${icon('info', 'w-4 h-4 mr-1')} About
                            </a>
                            <a onclick="navigate('contact')" class="hover:text-indigo-600 transition-colors cursor-pointer flex items-center">
                                ${icon('mail', 'w-4 h-4 mr-1')} Contact
                            </a>
                        </nav>
                    </div>
                </header>
            `;
            
            // --- NEW: Home View (Feature Categorization) ---
            const renderHomeView = () => `
                <div class="max-w-6xl mx-auto p-6 lg:p-10 mt-8">
                    <section class="card p-8 text-center bg-indigo-50 shadow-xl border-t-4 border-indigo-600">
                        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 leading-tight">
                            Succession Planning & Leadership Development Platform
                        </h1>
                        <p class="text-gray-600 mt-4 max-w-3xl mx-auto text-lg">
                            Leveraging AI to create personalized, actionable Individual Development Plans (IDPs) for POWERGRID's future leaders.
                        </p>
                    </section>
                    
                    <section class="mt-10">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            ${icon('tool', 'w-6 h-6 mr-2 text-indigo-600')} Core System Features
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            
                            <!-- Feature 1: 9-Box Matrix -->
                            <div class="card p-6 bg-white border-l-4 border-indigo-500 flex flex-col justify-between">
                                <div class="flex items-center space-x-4 mb-4">
                                    ${icon('layout-grid', 'w-8 h-8 text-indigo-500')}
                                    <h3 class="text-xl font-bold text-gray-800">Visual Succession Grid</h3>
                                </div>
                                <p class="text-gray-600 flex-grow mb-4">
                                    Visualize the entire high-potential employee pool based on the 9-Box Performance-Potential Matrix. Clickable to access detailed records.
                                </p>
                                <button onclick="navigate('matrix')" class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition flex items-center justify-center">
                                    ${icon('eye', 'w-5 h-5 mr-2')} View 9-Box Matrix
                                </button>
                            </div>

                            <!-- Feature 2: Generate New IDP -->
                            <div class="card p-6 bg-white border-l-4 border-green-500 flex flex-col justify-between">
                                <div class="flex items-center space-x-4 mb-4">
                                    ${icon('zap', 'w-8 h-8 text-green-500')}
                                    <h3 class="text-xl font-bold text-gray-800">AI-Powered IDP Generation</h3>
                                </div>
                                <p class="text-gray-600 flex-grow mb-4">
                                    Initiate a new AI analysis for a selected employee and target role to instantly generate a prioritized IDP draft with quantified gaps.
                                </p>
                                <button onclick="navigate('generate')" class="w-full py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition flex items-center justify-center">
                                    ${icon('user-plus', 'w-5 h-5 mr-2')} Run New Analysis
                                </button>
                            </div>
                        </div>
                    </section>
                    
                    <section class="mt-10">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            ${icon('bar-chart-2', 'w-6 h-6 mr-2 text-red-500')} Tracking & Analytics
                        </h2>
                        <div class="card p-6 bg-white border-l-4 border-red-500">
                             <h3 class="text-xl font-bold text-gray-800 mb-4">IDP Progress Summary (${STATE.idpList.length} Active Plans)</h3>
                             
                             ${STATE.idpList.length > 0 ? `
                                <div class="space-y-3">
                                    ${STATE.idpList.slice(0, 3).map(idp => `
                                        <div class="flex justify-between items-center py-2 border-b last:border-b-0">
                                            <span class="text-gray-700 font-medium">${idp.employee.name} (${idp.role.title})</span>
                                            <span class="text-indigo-600 font-bold">${idp.completion}% Complete</span>
                                        </div>
                                    `).join('')}
                                    <button onclick="navigate('matrix')" class="mt-4 text-sm text-indigo-600 hover:text-indigo-800 font-semibold">
                                        View All Records via Matrix Â»
                                    </button>
                                </div>
                             ` : `
                                <p class="text-gray-500">No active plans found. Start by generating a new IDP.</p>
                             `}
                        </div>
                    </section>
                </div>
            `;


            // --- Component: 9-Box Matrix (Interactive Hub) ---
            const renderNineBoxMatrix = () => {
                const matrixData = [
                    // Performance: High (Y=3)
                    [{ label: 'Top Talent (9)', color: 'bg-green-500', minPerf: 4, minPot: 4 }, { label: 'Impact Player (8)', color: 'bg-green-300', minPerf: 4, minPot: 3 }, { label: 'Solid Performer (7)', color: 'bg-yellow-300', minPerf: 4, minPot: 1 }],
                    // Performance: Moderate (Y=2)
                    [{ label: 'High Potential (6)', color: 'bg-yellow-500', minPerf: 3, minPot: 4 }, { label: 'Core Player (5)', color: 'bg-gray-300', minPerf: 3, minPot: 3 }, { label: 'Effective Contributor (4)', color: 'bg-orange-400', minPerf: 3, minPot: 1 }],
                    // Performance: Low (Y=1)
                    [{ label: 'Potential Gem (3)', color: 'bg-red-400', minPerf: 1, minPot: 4 }, { label: 'Question Mark (2)', color: 'bg-red-500', minPerf: 1, minPot: 3 }, { label: 'Underperformer (1)', color: 'bg-red-700', minPerf: 1, minPot: 1 }]
                ];

                // Populate employees into the matrix
                EMPLOYEE_DATA.forEach(e => {
                    const perf = e.performance;
                    const pot = e.potential;
                    
                    let row = -1, col = -1;
                    if (perf >= 4) row = 0; else if (perf === 3) row = 1; else if (perf <= 2) row = 2; 
                    if (pot >= 4) col = 0; else if (pot === 3) col = 1; else if (pot <= 2) col = 2; 

                    if (row !== -1 && col !== -1) {
                        if (!matrixData[row][col].employees) matrixData[row][col].employees = [];
                        matrixData[row][col].employees.push(e); 
                    }
                });
                
                return `
                    <div class="max-w-6xl mx-auto p-6 lg:p-10 mt-8">
                        <div class="card p-6 border-t-4 border-indigo-600">
                            <h2 class="text-3xl font-bold text-gray-800 mb-2 flex items-center">
                                ${icon('activity', 'w-7 h-7 mr-3 text-indigo-600')}
                                Succession Planning Grid (9-Box Matrix)
                            </h2>
                            <p class="text-gray-600 mb-6">
                                **Click on an employee's initials** to view their full profile, records, and active development plan status.
                            </p>
                            <div class="flex">
                                <!-- Y-Axis Labels -->
                                <div class="flex flex-col border-y border-l border-gray-300">
                                    <span class="nine-box-y-label h-[100px] sm:h-[120px]">HIGH Performance</span>
                                    <span class="nine-box-y-label h-[100px] sm:h-[120px]">MODERATE Performance</span>
                                    <span class="nine-box-y-label h-[100px] sm:h-[120px] border-b-0">LOW Performance</span>
                                </div>
                                <!-- Matrix Grid -->
                                <div class="flex flex-col w-full border border-gray-300 shadow-xl rounded-r-xl overflow-hidden">
                                    <!-- Matrix Rows -->
                                    ${matrixData.map((row, rIdx) => `
                                        <div class="flex w-full ${rIdx < 2 ? 'border-b border-gray-300' : ''}">
                                            ${row.map((cell, cIdx) => `
                                                <div class="nine-box-cell flex-1 p-2 border-gray-300 ${cIdx < 2 ? 'border-r' : ''} ${cell.color} bg-opacity-80">
                                                    <span class="text-sm font-bold text-gray-900 mb-2">${cell.label}</span>
                                                    <div class="flex flex-wrap justify-center items-center gap-2">
                                                        ${(cell.employees || []).map(e => `
                                                            <button onclick="viewEmployeeRecords(${e.id})" title="${e.name} - View Records" class="w-8 h-8 rounded-full text-xs font-bold employee-initial-btn transition transform">
                                                                ${e.name.split(' ').map(n => n[0]).join('')}
                                                            </button>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `).join('')}
                                    <!-- X-Axis Labels (Potential) -->
                                    <div class="flex w-full bg-gray-100 font-bold text-xs sm:text-sm text-gray-700 border-t border-gray-300">
                                        <div class="flex-1 text-center py-2 border-r border-gray-300">HIGH Potential</div>
                                        <div class="flex-1 text-center py-2 border-r border-gray-300">MODERATE Potential</div>
                                        <div class="flex-1 text-center py-2">LOW Potential</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            };
            
            // --- Component: Employee Details & Records View (Dynamic Data) ---
            const renderEmployeeDetailView = () => {
                const employee = STATE.selectedEmployee;
                if (!employee) return renderNineBoxMatrix();

                const nineBox = getNineBoxPosition(employee.performance, employee.potential);
                const employeeIDPs = STATE.idpList.filter(idp => idp.employee.id === employee.id);

                return `
                    <div class="max-w-6xl mx-auto p-6 lg:p-10 mt-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold text-gray-800 flex items-center">
                                ${icon('user-check', 'w-7 h-7 mr-3 text-indigo-600')}
                                Employee Development Record: ${employee.name}
                            </h2>
                            <button onclick="navigate('matrix')" class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center transition">
                                ${icon('arrow-left', 'w-4 h-4 mr-1')} Back to Matrix
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            
                            <!-- Col 1: Summary & 9-Box Status -->
                            <div class="lg:col-span-1 space-y-6">
                                
                                <!-- Employee Details Card -->
                                <div class="card p-6 border-t-4 border-indigo-600">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">${employee.name}</h3>
                                    <p class="text-sm text-gray-600 mb-4">${employee.position}</p>
                                    <div class="text-sm space-y-2">
                                        <p class="flex justify-between">Performance Rating: <span class="font-semibold">${employee.performance}/5</span></p>
                                        <p class="flex justify-between">Potential Rating: <span class="font-semibold">${employee.potential}/5</span></p>
                                        <p class="flex justify-between">ADC Score (Latest): <span class="font-semibold">${employee.adcScore}</span></p>
                                        <p class="flex justify-between pt-2 border-t font-bold text-indigo-600">9-Box Rank: 
                                            <span class="${nineBox.color} text-gray-900 px-2 py-0.5 rounded-full text-xs font-bold">
                                                ${nineBox.label}
                                            </span>
                                        </p>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-4 border-t pt-2">
                                        **Historical Notes:** ${employee.history}
                                    </p>
                                </div>

                                <!-- Quick IDP Generator -->
                                <div class="card p-6 bg-indigo-50 border border-indigo-200">
                                    <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                                        ${icon('zap', 'w-5 h-5 mr-2 text-indigo-600')}
                                        Generate Next IDP
                                    </h4>
                                    <p class="text-sm text-gray-600 mb-4">Quickly launch the AI analysis for this employee.</p>
                                    <select id="quick-role-select" class="w-full p-2 text-sm border-gray-300 rounded-lg shadow-inner focus:ring-indigo-500 focus:border-indigo-500 mb-4">
                                        <option value="">-- Select Target Role --</option>
                                        ${ROLE_DATA.map(r => `
                                            <option value="${r.id}">${r.title}</option>
                                        `).join('')}
                                    </select>
                                    <button onclick="
                                        const roleId = document.getElementById('quick-role-select').value;
                                        if(roleId) { 
                                            STATE.selectedEmployee = employee;
                                            STATE.selectedRole = ROLE_DATA.find(r => r.id === roleId);
                                            generateIDP(); 
                                        } else { 
                                            setAlert('Please select a role first.');
                                        }" 
                                        class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition">
                                        Run AI Analysis
                                    </button>
                                </div>
                            </div>

                            <!-- Col 2 & 3: Historical IDPs and Tracking -->
                            <div class="lg:col-span-2 space-y-6">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                                    ${icon('clipboard-list', 'w-6 h-6 mr-2 text-green-600')}
                                    Active & Historical IDPs (${employeeIDPs.length} Found)
                                </h3>

                                ${employeeIDPs.length > 0 ? `
                                    <div class="space-y-4">
                                        ${employeeIDPs.map(idp => `
                                            <div class="card p-5 border-l-4 border-green-500 flex justify-between items-center transition hover:shadow-lg">
                                                <div>
                                                    <p class="text-lg font-bold text-gray-800">Target: ${idp.role.title}</p>
                                                    <p class="text-sm text-gray-500">
                                                        Status: <span class="font-medium text-indigo-600">${idp.status}</span>
                                                    </p>
                                                </div>
                                                <div class="flex items-center space-x-4">
                                                    <div class="text-right">
                                                        <span class="text-xl font-bold text-indigo-700">${idp.completion}%</span>
                                                        <p class="text-xs text-gray-500">Completed</p>
                                                    </div>
                                                    <button onclick="viewIDPDetail('${idp.id}')" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition flex items-center">
                                                        ${icon('file-text', 'w-4 h-4 mr-2')} Track Progress
                                                    </button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <div class="p-6 bg-gray-50 rounded-xl text-center text-gray-500">
                                        ${icon('info', 'w-5 h-5 mx-auto mb-2')}
                                        <p>No active IDPs found for ${employee.name}. Launch a new analysis above.</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            };

            // --- Component: IDP Recommendation/Tracking View (Uses Chart) ---
            const renderRecommendationView = () => {
                if (!STATE.recommendationResult) return navigate('matrix');

                const idp = STATE.recommendationResult;
                const totalGap = idp.gapDetails.reduce((sum, d) => sum + d.gap, 0);

                const gapToCloseData = idp.gapDetails.filter(d => d.gap > 0).map(d => ({
                    label: d.name,
                    value: d.gap, 
                    color: d.gap > 20 ? '#EF4444' : d.gap > 10 ? '#F59E0B' : '#10B981'
                }));

                const getActivityStatusTag = (status) => {
                    let color = 'gray';
                    if (status === 'Planned') color = 'blue';
                    if (status === 'In Progress') color = 'indigo';
                    if (status === 'Completed') color = 'teal';
                    return `<span class="text-xs font-bold px-2 py-1 rounded-full text-${color}-700 bg-${color}-100">${status}</span>`;
                };


                return `
                    <div class="max-w-6xl mx-auto p-6 lg:p-10 mt-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold text-gray-800 flex items-center">
                                ${icon('bar-chart-3', 'w-7 h-7 mr-3 text-red-600')}
                                IDP Analysis & Tracking
                            </h2>
                            <button onclick="navigate('employeeDetail')" class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center transition">
                                ${icon('arrow-left', 'w-4 h-4 mr-1')} Back to Employee Records
                            </button>
                        </div>

                        <!-- Summary Card -->
                        <div class="card p-6 mb-8 border-t-4 border-indigo-600">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">${idp.employee.name}</h3>
                            <p class="text-lg text-gray-600 mb-4">
                                Target Role: <span class="font-medium text-indigo-600">${idp.role.title}</span> | 
                                Status: <span class="font-medium">${idp.status} (${idp.completion}%)</span>
                            </p>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            
                            <!-- Col 1: Infographics (Gap Chart) -->
                            <div class="lg:col-span-1 space-y-6">
                                <div class="card p-6 border-t-4 border-red-500">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                        ${icon('pie-chart', 'w-5 h-5 mr-2 text-red-500')}
                                        Total Competency Gap (Visualization)
                                    </h3>
                                    ${renderDoughnutChart(gapToCloseData, 'Total Gap')}
                                    <div class="mt-4 space-y-1">
                                        ${gapToCloseData.map(d => `<div class="flex items-center text-sm">
                                            <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${d.color};"></div>
                                            <span class="text-gray-600">${d.label}: </span>
                                            <span class="font-semibold ml-auto text-gray-800">${d.value} Pts</span>
                                        </div>`).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Col 2 & 3: Development Activities & Tracking -->
                            <div class="lg:col-span-2">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                                    ${icon('list-todo', 'w-6 h-6 mr-2 text-indigo-600')}
                                    Development Activities List
                                </h3>
                                <div class="space-y-4">
                                    ${idp.activities.map((activity, index) => `
                                        <div class="card p-5 border-l-4 border-indigo-400">
                                            <div class="flex justify-between items-start mb-2">
                                                <h4 class="text-xl font-bold text-gray-800">${index + 1}. ${activity.title}</h4>
                                                ${getActivityStatusTag(activity.status)}
                                            </div>
                                            <div class="flex flex-wrap items-center justify-between text-sm text-gray-500 mb-3">
                                                <span class="font-medium px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700">${activity.type}</span>
                                                <div class="flex items-center text-green-700 font-semibold">
                                                    ${icon('star', 'w-4 h-4 mr-1')}
                                                    Predicted Impact: +${activity.predictedImpact} Points
                                                </div>
                                            </div>

                                            <p class="text-sm text-gray-600 border-t pt-3">
                                                **Targeted Competency:** <span class="font-medium">${activity.assignedTo}</span>.
                                            </p>
                                            
                                            <!-- Committee/Manager Tracking Update -->
                                            ${STATE.isAdmin ? `
                                                <div class="mt-4 pt-4 border-t border-gray-100 flex justify-end">
                                                    <button onclick="updateActivityStatus('${idp.id}', ${index}, 'Completed', ${idp.activities.length})" 
                                                        class="text-sm px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 flex items-center"
                                                        ${activity.status === 'Completed' || idp.status === 'Draft' ? 'disabled' : ''}>
                                                        ${activity.status === 'Completed' ? 'Activity Completed' : icon('check', 'w-4 h-4 mr-1') + ' Mark Completed'}
                                                    </button>
                                                </div>
                                            ` : ''}

                                        </div>
                                    `).join('')}
                                </div>
                                
                                <!-- Draft Approval Action (Only visible if status is Draft) -->
                                ${idp.status === 'Draft' ? `
                                    <div class="mt-8 bg-green-50 p-6 rounded-xl shadow-inner border border-green-200 flex justify-end">
                                        <button onclick="saveIDP(STATE.recommendationResult)" class="flex items-center justify-center px-6 py-3 border border-transparent text-lg font-semibold rounded-xl shadow-md text-white bg-green-600 hover:bg-green-700 transition transform hover:scale-[1.02]">
                                            ${icon('check-circle', 'w-5 h-5 mr-2')}
                                            Final Approval & Activate IDP
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            };
            
            // --- Component: Generate New IDP Form (Renamed) ---
            const renderGenerateIDPView = () => `
                <div class="max-w-4xl mx-auto p-6 lg:p-10 mt-8">
                    <div class="card p-8 shadow-2xl border-t-4 border-indigo-600">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            ${icon('user-plus', 'w-7 h-7 mr-3 text-indigo-600')}
                            AI-Powered IDP Generation
                        </h2>
                        <p class="text-gray-600 mb-8 border-l-4 border-indigo-500 pl-4 py-1 bg-indigo-50 rounded-lg">
                            Select the employee and their target key role to initiate the AI-driven gap analysis and development plan recommendation.
                        </p>

                        <div class="space-y-6">
                            <!-- Employee Selection -->
                            <div>
                                <label for="employee-select" class="block text-lg font-medium text-gray-700 mb-2">1. Select Employee Profile</label>
                                <select id="employee-select" class="mt-1 block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-lg rounded-xl shadow-inner transition">
                                    <option value="">-- Choose High Potential Employee --</option>
                                    ${EMPLOYEE_DATA.map(e => `
                                        <option value="${e.id}">
                                            ${e.name} (${e.position}) - ${getNineBoxPosition(e.performance, e.potential).label}
                                        </option>
                                    `).join('')}
                                </select>
                            </div>

                            <!-- Target Role Selection -->
                            <div>
                                <label for="role-select" class="block text-lg font-medium text-gray-700 mb-2">2. Select Target Key Role ('Success Profile')</label>
                                <select id="role-select" class="mt-1 block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-lg rounded-xl shadow-inner transition">
                                    <option value="">-- Choose Target Succession Role --</option>
                                    ${ROLE_DATA.map(r => `
                                        <option value="${r.id}">${r.title}</option>
                                    `).join('')}
                                </select>
                            </div>
                        </div>

                        <!-- Generation Button -->
                        <div class="mt-10">
                            <button onclick="generateIDP()" class="w-full flex justify-center items-center px-6 py-3 border border-transparent text-lg font-medium rounded-xl shadow-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition transform hover:scale-[1.01] ${STATE.isLoading ? 'opacity-75 cursor-not-allowed' : ''}" ${STATE.isLoading ? 'disabled' : ''}>
                                ${STATE.isLoading ? `<div class="loading-animation mr-3"></div>` : icon('zap', 'w-6 h-6 mr-3')}
                                ${STATE.isLoading ? 'Running AI Analysis...' : 'Generate Personalized IDP Draft'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // --- NEW: About View (Placeholder) ---
            const renderAboutView = () => `
                <div class="max-w-4xl mx-auto p-6 lg:p-10 mt-8">
                    <div class="card p-8 shadow-2xl border-t-4 border-indigo-600">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            ${icon('info', 'w-7 h-7 mr-3 text-indigo-600')} About This Project
                        </h2>
                        <p class="text-lg text-gray-600 mb-4">
                            This platform was developed as a solution for the **Smart India Hackathon (SIH)** problem statement related to **Intelligent Recommendation System for Personalized Individual Development Plans (IDPs)** within the context of POWERGRID's Succession Planning & Leadership Development Policy.
                        </p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 mt-6">
                            <li>**Objective:** Move beyond generic development guidelines to provide truly personalized, data-driven career roadmaps for potential successors.</li>
                            <li>**Key Technologies:** Simulated AI/ML for gap analysis, real-time tracking using Firestore, and modern, responsive web design (Tailwind CSS).</li>
                            <li>**Impact:** Improves talent readiness, reduces manual planning effort, and maximizes the effectiveness of development investments.</li>
                        </ul>
                    </div>
                </div>
            `;
            
            // --- NEW: Contact View (Placeholder) ---
            const renderContactView = () => `
                <div class="max-w-4xl mx-auto p-6 lg:p-10 mt-8">
                    <div class="card p-8 shadow-2xl border-t-4 border-indigo-600 text-center">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                            ${icon('mail', 'w-7 h-7 mr-3 text-indigo-600')} Contact & Support
                        </h2>
                        <p class="text-lg text-gray-600 mb-8">
                            For technical inquiries regarding this solution, please reach out to the development team.
                        </p>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-center space-x-3 text-gray-700">
                                ${icon('user', 'w-6 h-6')}
                                <span class="font-semibold">Team Lead:</span>
                                <span>[Your Name/Team Name]</span>
                            </div>
                            <div class="flex items-center justify-center space-x-3 text-gray-700">
                                ${icon('at-sign', 'w-6 h-6')}
                                <span class="font-semibold">Email:</span>
                                <span>team@[yourhackathonproject].com</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;


            // --- Main Content Rendering ---
            if (STATE.currentView === 'home') {
                content = renderHomeView();
            } else if (STATE.currentView === 'matrix') {
                content = renderNineBoxMatrix();
            } else if (STATE.currentView === 'generate') {
                content = renderGenerateIDPView();
            } else if (STATE.currentView === 'recommendation') {
                content = renderRecommendationView();
            } else if (STATE.currentView === 'employeeDetail') {
                content = renderEmployeeDetailView();
            } else if (STATE.currentView === 'about') {
                content = renderAboutView();
            } else if (STATE.currentView === 'contact') {
                content = renderContactView();
            }


            appContainer.innerHTML = renderHeader() + `
                <main class="container mx-auto px-4 pb-12">
                    ${content}
                </main>
                ${renderFooter()}
                ${renderAlert()}
            `;

            // Rerun Lucide icon rendering after content is updated
            lucide.createIcons();
        };

        // --- Component: Footer (Styled for Corporate Look) ---
        const renderFooter = () => `
            <footer class="text-center p-6 mt-8">
                <div class="max-w-7xl mx-auto border-t border-gray-300 pt-6">
                    <h3 class="text-xl font-bold text-gray-800">POWERGRID Successor Navigator</h3>
                    <p class="text-sm text-gray-500 mt-1">Driving the Next Generation of Leadership.</p>
                    <div class="flex justify-center space-x-4 text-gray-600 mt-4 text-xl">
                        <a href="#" class="hover:text-indigo-600 transition-colors" title="Twitter"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                        <a href="#" class="hover:text-indigo-600 transition-colors" title="LinkedIn"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                        <a href="#" class="hover:text-indigo-600 transition-colors" title="Email"><i data-lucide="mail" class="w-5 h-5"></i></a>
                    </div>
                </div>
                <p class="text-sm text-gray-400 mt-4">Â© 2025 POWERGRID. All rights reserved. | SIH Project Solution.</p>
            </footer>
        `;


        // Initialize on window load
        window.onload = () => {
            initializeFirebase();
            renderApp();
        };

    </script>

    <!-- Main Application Container -->
    <div id="app">
        <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
                <div class="loading-animation mx-auto mb-4 border-indigo-600 border-t-indigo-600" style="width: 40px; height: 40px;"></div>
                <p class="text-lg text-gray-600">Initializing POWERGRID System...</p>
            </div>
        </div>
    </div>

</body>
</html>
